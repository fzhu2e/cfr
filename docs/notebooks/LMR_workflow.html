
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PAGES 2k updates with Python tools &#8212; cfr  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=db61ab07" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=fca5bd30" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/LMR_workflow';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/cfr-logo.jpg" class="logo__image only-light" alt="cfr  documentation - Home"/>
    <script>document.write(`<img src="../_static/cfr-logo.jpg" class="logo__image only-dark" alt="cfr  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ug-installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-pp2k.html">pseudoPAGES2k</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="pp2k-pdb-load-viz.html">Loading and Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="pp2k-pdb-filter.html">Database Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="pp2k-dashboards.html">Validation Dashboards</a></li>
<li class="toctree-l2"><a class="reference internal" href="pp2k-ppe-pda.html">PPE: A PDA-based Reconstruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="pp2k-ppe-graphem.html">PPE: A GraphEM-based Reconstruction</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-climate.html">Climate</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="climate-io.html">Input/Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="climate-ops.html">Basic Operations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-proxy.html">Proxy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="proxy-io.html">Input/Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxy-ops.html">Basic Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxy-analysis.html">Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxy-composites.html">Composites</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxy-dups.html">Handling duplicate proxies in a <code class="docutils literal notranslate"><span class="pre">ProxyDatabase</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="proxy-load-dod2k.html">Visualize and filter <strong>DoD2k</strong> with <code class="docutils literal notranslate"><span class="pre">cfr</span></code></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-psm.html">PSM</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="psm-linear.html">Univariate linear regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-bilinear.html">Bivariate linear regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-ice-d18O.html">PSM for ice core d18O</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-lake-VarveThickness.html">PSM for lake varve thickness</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-coral-SrCa.html">PSM for coral Sr/Ca</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-coral-d18O.html">PSM for coral d18O</a></li>
<li class="toctree-l2"><a class="reference internal" href="psm-tree-TRW.html">PSM for tree TRW (VS-Lite)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-lmr.html">LMR</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="lmr-real-pages2k.html">Reconstructing the tropical Pacific SST with PAGES2k</a></li>
<li class="toctree-l2"><a class="reference internal" href="lmr-real-pages2k-indpdt-verif.html">Proxy Independent Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="lmr-assim-no-calib.html">Assimilating records whose PSMs cannot be calibrated</a></li>
<li class="toctree-l2"><a class="reference internal" href="lmr-recon-pr.html">Reconstructing precipitation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lmr-cli.html">Running DA with the Command Line Interface (CLI)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ug-graphem.html">GraphEM</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="graphem-primer.html">A primer on GraphEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphem-real-pages2k.html">Reconstructing the tropical Pacific SST with PAGES2k and GraphEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphem-cli.html">Running GraphEM with the Command Line Interface (CLI)</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../ug-api.html">API Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../cg-overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cg-working-with-codebase.html">Working with the Codebase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cg-updating-docs.html">Updating the Documentation</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fzhu2e/cfr" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fzhu2e/cfr/edit/main/notebooks/LMR_workflow.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fzhu2e/cfr/issues/new?title=Issue%20on%20page%20%2Fnotebooks/LMR_workflow.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/LMR_workflow.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>PAGES 2k updates with Python tools</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Authors">Authors</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Goal">Goal</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-Description">Data Description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-Retrieval">Data Retrieval</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#SPARQL-queries">SPARQL queries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-Processing">Data Processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Metadata-Cleaning">Metadata Cleaning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#End-game">End game</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="PAGES-2k-updates-with-Python-tools">
<h1>PAGES 2k updates with Python tools<a class="headerlink" href="#PAGES-2k-updates-with-Python-tools" title="Link to this heading">#</a></h1>
<section id="Authors">
<h2>Authors<a class="headerlink" href="#Authors" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://orcid.org/0000-0001-5920-4751">Julien Emile-Geay</a> &amp; <a class="reference external" href="https://orcid.org/0000-0001-7501-8430">Deborah Khider</a></p>
<section id="Goal">
<h3>Goal<a class="headerlink" href="#Goal" title="Link to this heading">#</a></h3>
<p>Integrate various code and data resources from the LinkedEarth/PReSto Python ecosystem to produce an updated climate field reconstruction of the climate of the Common Era (last 2,000 years).</p>
</section>
</section>
<section id="Data-Description">
<h2>Data Description<a class="headerlink" href="#Data-Description" title="Link to this heading">#</a></h2>
<p>This notebook makes use of the <code class="docutils literal notranslate"><span class="pre">LiPDGraph</span></code> database, a graph database that contains datasets from various working groups. For a list of these compilations, see <a class="reference external" href="https://lipdverse.org/project/">this page</a>.</p>
<p>In particular, we will be using PAGES2k and iso-2k for this demonstration.</p>
<ul class="simple">
<li><p>PAGES2k: PAGES2k Consortium., Emile-Geay, J., McKay, N. et al. A global multiproxy database for temperature reconstructions of the Common Era. Sci Data 4, 170088 (2017). doi:10.1038/sdata.2017.88</p></li>
<li><p>iso2k: Konecky, B. L., McKay, N. P., Churakova (Sidorova), O. V., Comas-Bru, L., Dassié, E. P., DeLong, K. L., Falster, G. M., Fischer, M. J., Jones, M. D., Jonkers, L., Kaufman, D. S., Leduc, G., Managave, S. R., Martrat, B., Opel, T., Orsi, A. J., Partin, J. W., Sayani, H. R., Thomas, E. K., Thompson, D. M., Tyler, J. J., Abram, N. J., Atwood, A. R., Cartapanis, O., Conroy, J. L., Curran, M. A., Dee, S. G., Deininger, M., Divine, D. V., Kern, Z., Porter, T. J., Stevenson, S. L., von Gunten,
L., and Iso2k Project Members: The Iso2k database: a global compilation of paleo-δ18O and δ2H records to aid understanding of Common Era climate, Earth Syst. Sci. Data, 12, 2261–2288, <a class="reference external" href="https://doi.org/10.5194/essd-12-2261-2020">https://doi.org/10.5194/essd-12-2261-2020</a>, 2020.</p></li>
<li><p>CoralHydro2k: Walter, R. M., H. R. Sayani, T. Felis, K. M. Cobb, N. J. Abram, A. K. Arzey, A. R. Atwood, L. D. Brenner, E. P. Dassi ́e, K. L. DeLong, B. Ellis, J. Emile-Geay, M. J. Fischer, N. F. Goodkin, J. A. Hargreaves, K. H. Kilbourne, H. Krawczyk, N. P. McKay, A. L. Moore, S. A. Murty, M. R. Ong, R. D. Ramos, E. V. Reed, D. Samanta, S. C. Sanchez, J. Zinke, and the PAGES CoralHydro2k Project Members (2023), The CoralHydro2k database: a global, actively curated compilation of coral δ18O
and Sr / Ca proxy records of tropical ocean hydrology and temperature for the Common Era, Earth System Science Data, 15(5), 2081–2116, doi:10.5194/essd-15-2081-2023.</p></li>
</ul>
</section>
<section id="Data-Retrieval">
<h2>Data Retrieval<a class="headerlink" href="#Data-Retrieval" title="Link to this heading">#</a></h2>
<p>Following <a class="reference external" href="http://linked.earth/pylipdTutorials/notebooks/L2_using_graphdb.html">this tutorial</a>, we perform a <a class="reference external" href="http://linked.earth/pylipdTutorials/graph.html#what-is-sparql">SPARQL query</a> on the <a class="reference external" href="https://lipdverse.org">LiPDverse</a> to assemble the most current dataset. We need a few packages do to so, both general-purpose ones <a class="reference external" href="https://pandas.pydata.org">pandas</a> and paleoclimate-centric ones like <a class="reference external" href="https://github.com/LinkedEarth/Pyleoclim_util">Pyleoclim</a> and
<a class="reference external" href="https://fzhu2e.github.io/cfr/">cfr</a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyleoclim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pyleo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cfr</span>
</pre></div>
</div>
</div>
<p>Point toward the database:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://linkedearth.graphdb.mint.isi.edu/repositories/LiPDVerse-dynamic&#39;</span>
</pre></div>
</div>
</div>
<section id="SPARQL-queries">
<h3>SPARQL queries<a class="headerlink" href="#SPARQL-queries" title="Link to this heading">#</a></h3>
<p>In the first query, we retrieve all the data in the PAGES2k and iso2k compilations that were tagged to be used in the temperature analysis for this compilations along with metadata regarding the location, the type of archive and proxy used. In a separate query, we gather data corresponding to CoralHydro2k. The reason why we cannot gather all 3 with one query is that the tag <code class="docutils literal notranslate"><span class="pre">useInGlobalTemperatureAnalysis</span></code> is present in the first two, but not the latter.</p>
<p>Each column is stored separately, so we also need to go grab the time axis. The query is as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;PREFIX le: &lt;http://linked.earth/ontology#&gt;</span>
<span class="s2">PREFIX le_var: &lt;http://linked.earth/ontology/variables#&gt;</span>
<span class="s2">PREFIX wgs84: &lt;http://www.w3.org/2003/01/geo/wgs84_pos#&gt;</span>


<span class="s2">PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">SELECT DISTINCT ?dataSetName ?archiveType ?geo_meanLat ?geo_meanLon ?geo_meanElev</span>
<span class="s2">    ?paleoData_variableName ?paleoData_values ?paleoData_units</span>
<span class="s2">    ?paleoData_proxy ?paleoData_proxyGeneral ?time_variableName ?time_values</span>
<span class="s2">    ?time_units ?compilationName ?TSID where{</span>

<span class="s2">    ?ds a le:Dataset .</span>
<span class="s2">    ?ds le:hasName ?dataSetName .</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">            ?ds le:hasArchiveType ?archiveTypeObj .</span>
<span class="s2">            ?archiveTypeObj rdfs:label ?archiveType .</span>
<span class="s2">        }</span>

<span class="s2">    ?ds le:hasLocation ?loc .</span>
<span class="s2">        OPTIONAL{?loc wgs84:lat ?geo_meanLat .}</span>
<span class="s2">        OPTIONAL{?loc wgs84:long ?geo_meanLon .}</span>
<span class="s2">        OPTIONAL {?loc wgs84:alt ?geo_meanElev .}</span>

<span class="s2">    ?ds le:hasPaleoData ?data .</span>
<span class="s2">    ?data le:hasMeasurementTable ?table .</span>
<span class="s2">    ?table le:hasVariable ?var .</span>
<span class="s2">    ?var le:hasName ?paleoData_variableName .</span>
<span class="s2">    ?var le:hasValues ?paleoData_values .</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?var le:hasUnits ?paleoData_unitsObj .</span>
<span class="s2">        ?paleoData_unitsObj rdfs:label ?paleoData_units .</span>
<span class="s2">    }</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?var le:hasProxy ?paleoData_proxyObj .</span>
<span class="s2">        ?paleoData_proxyObj rdfs:label ?paleoData_proxy .</span>
<span class="s2">    }</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?var le:hasProxyGeneral ?paleoData_proxyGeneralObj .</span>
<span class="s2">        ?paleoData_proxyGeneralObj rdfs:label ?paleoData_proxyGeneral .</span>
<span class="s2">    }</span>
<span class="s2">    ?var le:partOfCompilation ?compilation .</span>
<span class="s2">    ?compilation le:hasName ?compilationName .</span>
<span class="s2">    VALUES ?compilationName {&quot;iso2k&quot; &quot;Pages2kTemperature&quot;} .</span>
<span class="s2">    ?var le:useInGlobalTemperatureAnalysis True .</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?var le:hasVariableId ?TSID</span>
<span class="s2">    } .</span>

<span class="s2">    ?table le:hasVariable ?timevar .</span>
<span class="s2">    ?timevar le:hasName ?time_variableName .</span>
<span class="s2">    ?timevar le:hasStandardVariable le_var:year .</span>
<span class="s2">    ?timevar le:hasValues ?time_values .</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?timevar le:hasUnits ?time_unitsObj .</span>
<span class="s2">        ?time_unitsObj rdfs:label ?time_units .</span>
<span class="s2">    }</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<p>For an explanation, see <a class="reference external" href="http://linked.earth/pylipdTutorials/notebooks/L2_using_graphdb.html">this tutorial</a>. For results, let’s just send our query over to the server and get the results into a pandas dataframe:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query1</span><span class="p">})</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dataSetName</th>
      <th>archiveType</th>
      <th>geo_meanLat</th>
      <th>geo_meanLon</th>
      <th>geo_meanElev</th>
      <th>paleoData_variableName</th>
      <th>paleoData_values</th>
      <th>paleoData_units</th>
      <th>paleoData_proxy</th>
      <th>paleoData_proxyGeneral</th>
      <th>time_variableName</th>
      <th>time_values</th>
      <th>time_units</th>
      <th>compilationName</th>
      <th>TSID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LS16STCL</td>
      <td>Lake sediment</td>
      <td>50.8300</td>
      <td>-116.3900</td>
      <td>1126.0</td>
      <td>d18O</td>
      <td>[-7.81, -5.91, -9.03, -5.35, -5.61, -5.98, -5....</td>
      <td>permil</td>
      <td>d18O</td>
      <td>NaN</td>
      <td>year</td>
      <td>[2009.0, 2008.3, 2007.8, 2007.4, 2007.0, 2006....</td>
      <td>yr AD</td>
      <td>iso2k</td>
      <td>LPD7dc5b9ba</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CO00URMA</td>
      <td>Coral</td>
      <td>0.9330</td>
      <td>173.0000</td>
      <td>6.0</td>
      <td>d18O</td>
      <td>[-4.8011, -4.725, -4.6994, -4.86, -5.0886, -5....</td>
      <td>permil</td>
      <td>d18O</td>
      <td>NaN</td>
      <td>year</td>
      <td>[1994.5, 1994.33, 1994.17, 1994.0, 1993.83, 19...</td>
      <td>yr AD</td>
      <td>iso2k</td>
      <td>Ocean2kHR_177</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CO05KUBE</td>
      <td>Coral</td>
      <td>32.4670</td>
      <td>-64.7000</td>
      <td>-12.0</td>
      <td>d18O</td>
      <td>[-4.15, -3.66, -3.69, -4.07, -3.95, -4.12, -3....</td>
      <td>permil</td>
      <td>d18O</td>
      <td>NaN</td>
      <td>year</td>
      <td>[1983.21, 1983.13, 1983.04, 1982.96, 1982.88, ...</td>
      <td>yr AD</td>
      <td>iso2k</td>
      <td>Ocean2kHR_105</td>
    </tr>
    <tr>
      <th>3</th>
      <td>IC13THQU</td>
      <td>Glacier ice</td>
      <td>-13.9333</td>
      <td>-70.8333</td>
      <td>5670.0</td>
      <td>d18O</td>
      <td>[-18.5905, -16.3244, -16.2324, -17.0112, -18.6...</td>
      <td>permil</td>
      <td>d18O</td>
      <td>NaN</td>
      <td>year</td>
      <td>[2009, 2008, 2007, 2006, 2005, 2004, 2003, 200...</td>
      <td>yr AD</td>
      <td>iso2k</td>
      <td>SAm_035</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CO01TUNG</td>
      <td>Coral</td>
      <td>-5.2170</td>
      <td>145.8170</td>
      <td>-3.0</td>
      <td>d18O</td>
      <td>[-4.875, -4.981, -5.166, -5.06, -4.942, -4.919...</td>
      <td>permil</td>
      <td>d18O</td>
      <td>NaN</td>
      <td>year</td>
      <td>[1993.042, 1992.792, 1992.542, 1992.292, 1992....</td>
      <td>yr AD</td>
      <td>iso2k</td>
      <td>Ocean2kHR_141</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;PREFIX le: &lt;http://linked.earth/ontology#&gt;</span>
<span class="s2">PREFIX le_var: &lt;http://linked.earth/ontology/variables#&gt;</span>
<span class="s2">PREFIX wgs84: &lt;http://www.w3.org/2003/01/geo/wgs84_pos#&gt;</span>


<span class="s2">PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span class="s2">SELECT DISTINCT ?dataSetName ?archiveType ?geo_meanLat ?geo_meanLon ?geo_meanElev</span>
<span class="s2">    ?paleoData_variableName ?paleoData_values ?paleoData_units</span>
<span class="s2">    ?paleoData_proxy ?paleoData_proxyGeneral ?time_variableName ?time_values</span>
<span class="s2">    ?time_units ?compilationName ?TSID where{</span>

<span class="s2">    ?ds a le:Dataset .</span>
<span class="s2">    ?ds le:hasName ?dataSetName .</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">            ?ds le:hasArchiveType ?archiveTypeObj .</span>
<span class="s2">            ?archiveTypeObj rdfs:label ?archiveType .</span>
<span class="s2">        }</span>

<span class="s2">    ?ds le:hasLocation ?loc .</span>
<span class="s2">        OPTIONAL{?loc wgs84:lat ?geo_meanLat .}</span>
<span class="s2">        OPTIONAL{?loc wgs84:long ?geo_meanLon .}</span>
<span class="s2">        OPTIONAL {?loc wgs84:alt ?geo_meanElev .}</span>

<span class="s2">    ?ds le:hasPaleoData ?data .</span>
<span class="s2">    ?data le:hasMeasurementTable ?table .</span>
<span class="s2">    ?table le:hasVariable ?var .</span>
<span class="s2">    ?var le:hasName ?paleoData_variableName .</span>
<span class="s2">    ?var le:hasValues ?paleoData_values .</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?var le:hasUnits ?paleoData_unitsObj .</span>
<span class="s2">        ?paleoData_unitsObj rdfs:label ?paleoData_units .</span>
<span class="s2">    }</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?var le:hasProxy ?paleoData_proxyObj .</span>
<span class="s2">        ?paleoData_proxyObj rdfs:label ?paleoData_proxy .</span>
<span class="s2">    }</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?var le:hasProxyGeneral ?paleoData_proxyGeneralObj .</span>
<span class="s2">        ?paleoData_proxyGeneralObj rdfs:label ?paleoData_proxyGeneral .</span>
<span class="s2">    }</span>
<span class="s2">    ?var le:partOfCompilation ?compilation .</span>
<span class="s2">    ?compilation le:hasName ?compilationName .</span>
<span class="s2">    VALUES ?compilationName {&quot;CoralHydro2k&quot;} .</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?var le:hasVariableId ?TSID</span>
<span class="s2">    } .</span>

<span class="s2">    ?table le:hasVariable ?timevar .</span>
<span class="s2">    ?timevar le:hasName ?time_variableName .</span>
<span class="s2">    ?timevar le:hasStandardVariable le_var:year .</span>
<span class="s2">    ?timevar le:hasValues ?time_values .</span>
<span class="s2">    OPTIONAL{</span>
<span class="s2">        ?timevar le:hasUnits ?time_unitsObj .</span>
<span class="s2">        ?time_unitsObj rdfs:label ?time_units .</span>
<span class="s2">    }</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query2</span><span class="p">})</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dataSetName</th>
      <th>archiveType</th>
      <th>geo_meanLat</th>
      <th>geo_meanLon</th>
      <th>geo_meanElev</th>
      <th>paleoData_variableName</th>
      <th>paleoData_values</th>
      <th>paleoData_units</th>
      <th>paleoData_proxy</th>
      <th>paleoData_proxyGeneral</th>
      <th>time_variableName</th>
      <th>time_values</th>
      <th>time_units</th>
      <th>compilationName</th>
      <th>TSID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KA17RYU01</td>
      <td>Coral</td>
      <td>28.300</td>
      <td>130.000</td>
      <td>-3.5</td>
      <td>SrCa</td>
      <td>[8.802, 9.472, 8.825, 9.355, 8.952, 9.297, 8.8...</td>
      <td>mmol/mol</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>year</td>
      <td>[1578.58, 1579.08, 1579.58, 1580.08, 1580.58, ...</td>
      <td>yr AD</td>
      <td>CoralHydro2k</td>
      <td>KA17RYU01_SrCa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CH18YOA02</td>
      <td>Coral</td>
      <td>16.448</td>
      <td>111.605</td>
      <td>NaN</td>
      <td>SrCa</td>
      <td>[8.58, 8.683, 8.609, 8.37, 8.38, 8.417, 8.584,...</td>
      <td>mmol/mol</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>year</td>
      <td>[1987.92, 1988.085, 1988.25, 1988.42, 1988.585...</td>
      <td>yr AD</td>
      <td>CoralHydro2k</td>
      <td>CH18YOA02_SrCa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FL17DTO02</td>
      <td>Coral</td>
      <td>24.699</td>
      <td>-82.799</td>
      <td>-3.0</td>
      <td>SrCa</td>
      <td>[9.159, 9.257, 9.245, 9.166, 9.045, 9.013, 8.9...</td>
      <td>mmol/mol</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>year</td>
      <td>[1837.04, 1837.13, 1837.21, 1837.29, 1837.38, ...</td>
      <td>yr AD</td>
      <td>CoralHydro2k</td>
      <td>FL17DTO02_SrCa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BO14HTI01</td>
      <td>Coral</td>
      <td>12.210</td>
      <td>109.310</td>
      <td>-3.6</td>
      <td>d18O</td>
      <td>[-5.4206, -5.3477, -5.1354, -5.7119, -5.9058, ...</td>
      <td>permil</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>year</td>
      <td>[1977.37, 1977.45, 1977.54, 1977.62, 1977.7, 1...</td>
      <td>yr AD</td>
      <td>CoralHydro2k</td>
      <td>BO14HTI01_d18O</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BO14HTI01</td>
      <td>Coral</td>
      <td>12.210</td>
      <td>109.310</td>
      <td>-3.6</td>
      <td>SrCa</td>
      <td>[9.2, 9.17, 9.11, 9.02, 8.95, 8.99, 9.06, 9.1,...</td>
      <td>mmol/mol</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>year</td>
      <td>[1600.04, 1600.12, 1600.2, 1600.28, 1600.37, 1...</td>
      <td>yr AD</td>
      <td>CoralHydro2k</td>
      <td>BO14HTI01_SrCa</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now let’s merge the dataframes. First, confirm they have the same number of columns:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(919, 15)
</pre></div></div>
</div>
</section>
<section id="Data-Processing">
<h3>Data Processing<a class="headerlink" href="#Data-Processing" title="Link to this heading">#</a></h3>
<p>Much like <a class="reference external" href="http://linked.earth/pylipdTutorials/intro.html">PyLiPD</a>, the information is contained in columns with each row representing a time series. For efficiency reasons, the data are stored as strings, so we need to convert each row to numpy arrays or list. Here is a way to do so:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span> <span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">row</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time_values&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time_values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span> <span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we need to put the data into a form that <a class="reference external" href="https://fzhu2e.github.io/cfr/">cfr</a> can work with. We now adapt <a class="reference external" href="https://khider.github.io/DISK-proxyComposite/intro.html">this example</a>. First, let’s see what columns we have in our dataframe:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;dataSetName&#39;, &#39;archiveType&#39;, &#39;geo_meanLat&#39;, &#39;geo_meanLon&#39;,
       &#39;geo_meanElev&#39;, &#39;paleoData_variableName&#39;, &#39;paleoData_values&#39;,
       &#39;paleoData_units&#39;, &#39;paleoData_proxy&#39;, &#39;paleoData_proxyGeneral&#39;,
       &#39;time_variableName&#39;, &#39;time_values&#39;, &#39;time_units&#39;, &#39;compilationName&#39;,
       &#39;TSID&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
<p>Let’s confirm that we have all three compilations in here:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;compilationName&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;iso2k&#39;, &#39;Pages2kTemperature&#39;, &#39;CoralHydro2k&#39;], dtype=object)
</pre></div></div>
</div>
<p>Let’s inspect this dataset by archive and variable type:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">,</span><span class="s1">&#39;paleoData_variableName&#39;</span><span class="p">]]</span>

<span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;archiveType&#39;</span><span class="p">,</span><span class="s1">&#39;paleoData_variableName&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>archiveType</th>
      <th>paleoData_variableName</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Borehole</td>
      <td>temperature</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Coral</td>
      <td>SrCa</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Coral</td>
      <td>Sr_Ca</td>
      <td>24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Coral</td>
      <td>calcification</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Coral</td>
      <td>composite</td>
      <td>6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Coral</td>
      <td>d18O</td>
      <td>240</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Coral</td>
      <td>d18O_sw</td>
      <td>19</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Coral</td>
      <td>temperature</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Documents</td>
      <td>temperature</td>
      <td>14</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Glacier ice</td>
      <td>d18O</td>
      <td>16</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Glacier ice</td>
      <td>dD</td>
      <td>3</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Lake sediment</td>
      <td>RABD660_670</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Lake sediment</td>
      <td>X_radiograph_dark_layer</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Lake sediment</td>
      <td>d18O</td>
      <td>3</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Lake sediment</td>
      <td>d2H</td>
      <td>1</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Lake sediment</td>
      <td>temperature</td>
      <td>27</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Lake sediment</td>
      <td>thickness</td>
      <td>3</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Marine sediment</td>
      <td>d18O</td>
      <td>1</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Marine sediment</td>
      <td>temperature</td>
      <td>53</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Mollusk shell</td>
      <td>d18O</td>
      <td>1</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Sclerosponge</td>
      <td>Sr_Ca</td>
      <td>4</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Sclerosponge</td>
      <td>d18O</td>
      <td>7</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Speleothem</td>
      <td>d18O</td>
      <td>4</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Wood</td>
      <td>MXD</td>
      <td>53</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Wood</td>
      <td>density</td>
      <td>5</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Wood</td>
      <td>temperature</td>
      <td>6</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Wood</td>
      <td>trsgi</td>
      <td>321</td>
    </tr>
    <tr>
      <th>27</th>
      <td>hybrid</td>
      <td>temperature</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>However, there are duplicates that belong to more than 1 compilation. Thankfully, <a class="reference external" href="https://fzhu2e.github.io/cfr/notebooks/proxy-dups.html">cfr can deal with that</a></p>
</section>
<section id="Metadata-Cleaning">
<h3>Metadata Cleaning<a class="headerlink" href="#Metadata-Cleaning" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cfr</span></code> needs a field call <code class="docutils literal notranslate"><span class="pre">ptype</span></code> that is a juxtaposition of the archive and observation type (e.g. ‘coral.d18O’). For this to work, those strings first need to be aligned to the <a class="reference external" href="https://lipdverse.org/vocabulary/">LiPDverse controlled vocabularies</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_vocab_synonyms</span><span class="p">(</span><span class="n">vocab</span><span class="o">=</span><span class="s1">&#39;archivetype&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scrape the LiPDverse website to obtain the list of possible variable names and associated synonyms</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    vocab : str</span>
<span class="sd">        Name of the vocabulary used for retrieval</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res : Dictionary</span>
<span class="sd">        Keys correspond to the preferred terms and values represent known synonyms</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">known_vocabs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;archivetype&#39;</span><span class="p">,</span><span class="s1">&#39;interpretation_seasonality&#39;</span><span class="p">,</span><span class="s1">&#39;interpretation_variable&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;paleodata_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;paleodata_proxygeneral&#39;</span><span class="p">,</span> <span class="s1">&#39;paleodata_units&#39;</span><span class="p">,</span> <span class="s1">&#39;paleodata_variablename&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">vocab</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">known_vocabs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">valueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unknown vocabulary: </span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">stacklevel</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://lipdverse.org/vocabulary/&#39;</span> <span class="o">+</span> <span class="n">vocab</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Parse the content of the request with BeautifulSoup</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
        <span class="c1"># Get the names</span>
        <span class="n">h3_tags</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">)</span>
        <span class="n">archiveName</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">h3_tags</span><span class="p">:</span>
            <span class="n">archiveName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>

        <span class="c1"># Get the known synonyms</span>
        <span class="n">h4_tags</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;h4&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Known synonyms&quot;</span><span class="p">)</span>
        <span class="n">synonyms</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">h4_tag</span> <span class="ow">in</span> <span class="n">h4_tags</span><span class="p">:</span>
            <span class="n">next_element</span> <span class="o">=</span> <span class="n">h4_tag</span><span class="o">.</span><span class="n">find_next_sibling</span><span class="p">()</span>

            <span class="n">found_p</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="n">next_element</span> <span class="ow">and</span> <span class="n">next_element</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;div&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">next_element</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span>
                    <span class="n">synonyms_text</span> <span class="o">=</span> <span class="n">next_element</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">synonyms_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="n">synonyms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
                    <span class="n">found_p</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="n">next_element</span> <span class="o">=</span> <span class="n">next_element</span><span class="o">.</span><span class="n">find_next_sibling</span><span class="p">()</span>

            <span class="c1"># If a &lt;p&gt; tag was not found, insert an empty string</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found_p</span><span class="p">:</span>
                <span class="n">synonyms</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="c1">#create a dictionary for the results</span>
        <span class="n">res</span><span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">archiveName</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">synonyms</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failed to retrieve the webpage; returning static list, which may be out of date&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">archive</span> <span class="o">=</span> <span class="n">get_vocab_synonyms</span><span class="p">(</span><span class="n">vocab</span><span class="o">=</span><span class="s1">&#39;archivetype&#39;</span><span class="p">)</span>
<span class="n">archive_clean</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># let&#39;s make all this lowercase and remove spaces</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">archive</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">clean</span> <span class="o">=</span> <span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">archive</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
    <span class="n">archive_clean</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">clean</span>
<span class="n">archive_clean</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;borehole&#39;: [],
 &#39;coral&#39;: [],
 &#39;fluvialsediment&#39;: [&#39;creek&#39;, &#39;fluvial&#39;, &#39;river&#39;, &#39;stream&#39;],
 &#39;glacierice&#39;: [],
 &#39;groundice&#39;: [],
 &#39;lakesediment&#39;: [&#39;lagoon&#39;, &#39;lake&#39;, &#39;lakesediment&#39;],
 &#39;marinesediment&#39;: [&#39;marine&#39;, &#39;delta&#39;],
 &#39;midden&#39;: [],
 &#39;molluskshell&#39;: [&#39;molluskshells&#39;],
 &#39;needstobechanged&#39;: [&#39;marl&#39;,
  &#39;meadow&#39;,
  &#39;ocean&#39;,
  &#39;paleosol&#39;,
  &#39;archaeological&#39;,
  &#39;coast&#39;,
  &#39;farmland&#39;,
  &#39;forest&#39;,
  &#39;sediment&#39;,
  &#39;spring&#39;,
  &#39;valley&#39;,
  &#39;wetland&#39;],
 &#39;peat&#39;: [&#39;bog&#39;, &#39;fen&#39;, &#39;marsh&#39;, &#39;mire&#39;, &#39;swamp&#39;],
 &#39;sclerosponge&#39;: [],
 &#39;shoreline&#39;: [&#39;lakedeposit&#39;, &#39;lakedeposits&#39;],
 &#39;speleothem&#39;: [&#39;cave&#39;],
 &#39;terrestrialsediment&#39;: [&#39;dune&#39;, &#39;loess&#39;],
 &#39;wood&#39;: []}
</pre></div></div>
</div>
<p>Create a list containing those values for each row of the dataframe</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">archiveType</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">archive_clean</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">or</span> <span class="n">match</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">archiveType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="n">archiveType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
documents
documents
documents
documents
documents
documents
documents
documents
documents
documents
documents
documents
hybrid
documents
documents
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">archiveType</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
919
</pre></div></div>
</div>
<p>Now let’s do the variable names ; we don’t show them because it’s a LONG list</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_std_raw</span> <span class="o">=</span> <span class="n">get_vocab_synonyms</span><span class="p">(</span><span class="n">vocab</span><span class="o">=</span><span class="s1">&#39;paleodata_variablename&#39;</span><span class="p">)</span>
<span class="n">var_std</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">var_std_raw</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">clean</span> <span class="o">=</span> <span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">var_std_raw</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
    <span class="n">var_std</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">clean</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variableName</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;paleoData_variableName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">var_std</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">or</span> <span class="n">match</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">variableName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">variableName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
xradiographdarklayer
dataSetName                                  Arc-LakeNataujaervi.Ojala.2005
archiveType                                                   Lake sediment
geo_meanLat                                                           61.81
geo_meanLon                                                           24.68
geo_meanElev                                                          103.7
paleoData_variableName                              X_radiograph_dark_layer
paleoData_values          [3550, 3127, 4101, 3366, 3812, 3337, 4240, 325...
paleoData_units                                                       count
paleoData_proxy                                             varve thickness
paleoData_proxyGeneral                                                  NaN
time_variableName                                                      year
time_values               [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,...
time_units                                                            yr AD
compilationName                                          Pages2kTemperature
TSID                                                                Arc_025
Name: 81, dtype: object
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">variableName</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
919
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ptype</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variableName</span><span class="p">):</span>
    <span class="n">ptype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archiveType</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">item</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ptype&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ptype</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="End-game">
<h2>End game<a class="headerlink" href="#End-game" title="Link to this heading">#</a></h2>
<p>Export a ProxyDatabase object that can then be used by <code class="docutils literal notranslate"><span class="pre">cfr</span></code>.</p>
<p>By default all proxy types will be visualized using the same default styles because the <code class="docutils literal notranslate"><span class="pre">ptype</span></code> strings are new to <code class="docutils literal notranslate"><span class="pre">cfr</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pdb</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">ProxyDatabase</span><span class="p">()</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">pid_column</span><span class="o">=</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">,</span>
    <span class="n">ptype_column</span><span class="o">=</span><span class="s1">&#39;ptype&#39;</span><span class="p">,</span>
    <span class="n">time_column</span><span class="o">=</span><span class="s1">&#39;time_values&#39;</span><span class="p">,</span>
    <span class="n">value_column</span><span class="o">=</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_LMR_workflow_34_0.png" src="../_images/notebooks_LMR_workflow_34_0.png" />
</div>
</div>
<p>We need to modify the styles as below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;wood.temperature&#39;</span><span class="p">:</span> <span class="s1">&#39;tab:green&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">markers_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;wood.temperature&#39;</span><span class="p">:</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">cfr</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">STYLE</span><span class="o">.</span><span class="n">colors_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">colors_dict</span><span class="p">)</span>
<span class="n">cfr</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">STYLE</span><span class="o">.</span><span class="n">markers_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">markers_dict</span><span class="p">)</span>

<span class="n">pdb</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">ProxyDatabase</span><span class="p">()</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">pid_column</span><span class="o">=</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">,</span>
    <span class="n">ptype_column</span><span class="o">=</span><span class="s1">&#39;ptype&#39;</span><span class="p">,</span>
    <span class="n">time_column</span><span class="o">=</span><span class="s1">&#39;time_values&#39;</span><span class="p">,</span>
    <span class="n">value_column</span><span class="o">=</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_LMR_workflow_36_0.png" src="../_images/notebooks_LMR_workflow_36_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pobj</span> <span class="o">=</span> <span class="n">pdb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pobj</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_LMR_workflow_37_0.png" src="../_images/notebooks_LMR_workflow_37_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_tas</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">ClimateField</span><span class="p">(</span><span class="n">da</span><span class="o">=</span><span class="p">)</span>

<span class="n">pobj</span><span class="o">.</span><span class="n">del_clim</span><span class="p">()</span>
<span class="n">pobj</span><span class="o">.</span><span class="n">get_clim</span><span class="p">(</span><span class="n">model_tas</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">pobj</span><span class="o">.</span><span class="n">get_clim</span><span class="p">(</span><span class="n">model_pr</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">pobj</span><span class="o">.</span><span class="n">get_clim</span><span class="p">(</span><span class="n">obs_tas_new</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">)</span>
<span class="n">pobj</span><span class="o">.</span><span class="n">get_clim</span><span class="p">(</span><span class="n">obs_pr_new</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mdl</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">psm</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">pobj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sn_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dataSetName 001&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;dataSetName 002&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pobj</span> <span class="ow">in</span> <span class="n">pdb</span><span class="p">:</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="n">sn_dict</span><span class="p">[</span><span class="n">pobj</span><span class="o">.</span><span class="n">pid</span><span class="p">]</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">season_list</span><span class="o">=</span><span class="n">sn</span><span class="p">)</span>
    <span class="n">pobj</span><span class="o">.</span><span class="n">psm</span> <span class="o">=</span> <span class="n">mdl</span>
    <span class="n">pobj</span><span class="o">.</span><span class="n">pseudo</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">pdb</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">sn_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
<span class="p">]</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">season_list</span><span class="o">=</span><span class="n">sn_list</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">calib_details</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pobj</span><span class="o">.</span><span class="n">psm</span> <span class="o">=</span> <span class="n">mdl</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pobj</span><span class="o">.</span><span class="n">pseudo</span> <span class="o">=</span> <span class="n">pp</span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Authors">Authors</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Goal">Goal</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-Description">Data Description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-Retrieval">Data Retrieval</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#SPARQL-queries">SPARQL queries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-Processing">Data Processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Metadata-Cleaning">Metadata Cleaning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#End-game">End game</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Feng Zhu, Julien Emile-Geay.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>